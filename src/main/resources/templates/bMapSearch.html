<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/css/list.css">
    <link rel="stylesheet" href="/css/kakaoMap.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.js"></script>
    <script type="text/javascript">
        $(".readMove").on("click",function (e){
            e.preventDefault();
            actionForm.append("<input type='hidden' name='boardId' value='" +
                $(this).attr("href")+"'>");
            actionForm.attr("action","/list");
            actionForm.submit();

        })

    </script>
</head>
<body>
    <th:block th:include="/include/navbar"> </th:block>
    <div class="map_wrap">
        <div id="map" style="width:100%;height:100%;position:relative;overflow:hidden;"></div>
        <div class="hAddr">
            <span class="title">지도중심기준 행정동 주소정보</span>
            <span id="centerAddr"></span>
        </div>
    </div>
    <div id="totalList">
        <table>
            <thead>
            <tr id="theadTh">
                <th >요일</th>
                <th >이미지</th>
                <th  colspan="2">설명</th>
                <th >등록일</th>
            </tr>
            </thead>
            <tbody th:each="boardList : ${boardList}">
            <td align="center" th:text="${boardList.week}"></td>
            <td align="center" th:text="${boardList.image}"></td>
            <td>
                <div id="listDivCol">
                    <p>
                        <a class="readMove" th:href="@{|/read?boardId=${boardList.boardId}|}" th:text="${boardList.title}">
                    </p>
                    <p>
                        <a class="readMove" th:href="@{|/read?boardId=${boardList.boardId}|}" th:text="${boardList.indexId}">
                    </p><br>
                    <p th:text="${boardList.genAddress}"></p>
                </div>
            </td>
            <td>
                <div id="listDivCol">
                    <p th:text="${boardList.tagBigName}"></p><br>
                    <p th:text="${boardList.tagSmallName}"></p>
                </div>
            </td>
            <td th:text="${#dates.format(boardList.updateDate,'yyyy-MM-dd')}"></td>

            </tbody>
        </table>
        <!-- 페이징처리 -->
        <!-- 이전 버튼 -->
        <div id="pagingButton">
            <nav aria-label="Page navigation example">
                <ul class="pagination">
                    <th:block th:if="${pageMaker.prev}">
                        <li class="page-item prev">
                            <a href="javascript:void(0)" class="page-link" th:onclick="movePage( [[ ${#request.requestURI} ]], [[ ${pageMaker.cri.makeQueryString(pageMaker.startPage - 1)} ]])">이전</a>
                        </li>
                    </th:block>
                    <!-- 페이지 번호-->
                    <th:block th:with="pageMaker = ${pageMaker}">
                        <th:block th:each="num : *{#numbers.sequence(pageMaker.startPage, pageMaker.endPage)}">
                            <li class="page-item" th:classappend="${pageMaker.cri.pageNum == num} ? 'active' : ''">
                                <a href="javascript:void(0)" class="page-link" th:text="${num}" th:onclick="movePage([[ ${#request.requestURI} ]],[[ ${pageMaker.cri.makeQueryString(num)} ]])"></a>
                            </li>
                        </th:block>
                    </th:block>
                    <th:block th:if="${pageMaker.next}">
                        <li class="page-item next">
                            <a href="javascript:void(0)" class="page-link" th:onclick="movePage( [[ ${#request.requestURI} ]], [[ ${pageMaker.cri.makeQueryString(pageMaker.endPage + 1)} ]])">다음</a>
                        </li>
                    </th:block>
                </ul>
            </nav>
        </div>
        <!-- 페이징 처리에 같이 갈 데이터 -->
        <form id="actionForm" action="list" method="get">
            <input type="hidden" name="pageNum" th:value="${pageMaker.cri.pageNum}">
            <input type="hidden" name="amount" th:value="${pageMaker.cri.amount}">
        </form>
    </div>
    <script th:javascript>
        /* ![CDATA[ */
        function movePage(uri, queryString) {
            console.log(uri);
            console.log(queryString);

            location.href = uri + queryString;
        }
        /* ]]*/
    </script>
    <input type="hidden" id="latitude">
    <input type="hidden" id="longitude">

    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=36bff8b96636a6127542c2c517175d6f&libraries=services"></script>
    <script th:inline="javascript">
        boardLists = [[${boardList}]]
        // console.log(JSON.stringify(boardLists))








        var mapContainer = document.getElementById('map'), // 지도를 표시할 div
            mapOption = {
                center: new kakao.maps.LatLng(37.4033, 126.931), // 지도의 중심좌표
                level: 5 // 지도의 확대 레벨
            };

        var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다


        // 마커를 표시할 위치와 title 객체 배열입니다
        var positions = []
        for(idx in boardLists){
            positions[idx] =
                {

                    content: boardLists[idx].title,
                    latlng: new kakao.maps.LatLng(boardLists[idx].lat, boardLists[idx].lon)
                }
        }





        // 마커 이미지의 이미지 주소입니다
        // var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png";

        for (var i = 0; i < positions.length; i ++) {

            // 마커를 생성합니다
            var marker = new kakao.maps.Marker({
                map: map, // 마커를 표시할 지도
                position: positions[i].latlng, // 마커를 표시할 위치
                // title : positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
                // image : markerImage, // 마커 이미지
                // clickable: true // 클릭시 이벤트
            });
            <!-- 추가 -->
            var infowindow = new kakao.maps.InfoWindow({
                content : positions[i].content
            });
            kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
            kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
        }
        // 인포윈도우를 표시하는 클로저를 만드는 함수입니다
        function makeOverListener(map, marker, infowindow) {
            return function() {
                infowindow.open(map, marker);
            };
        }

        // 인포윈도우를 닫는 클로저를 만드는 함수입니다
        function makeOutListener(infowindow) {
            return function() {
                infowindow.close();
            };
        }
    </script>
</body>
</html>